@page "/article/{Id}"
@page "/p/{Id}"

@using APP.Business.Services.Models;
@using APP.Business.Services;
@inject IBlogService _blogService;
@inject IArticleService _articleService;

<link href="/css/info.css" rel="stylesheet">
@*为Markdown加载样式*@
<link href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/2.9.0/github-markdown.min.css" rel="stylesheet" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" rel="stylesheet" />
<div class="infosbox">
    <div class="newsview">
        <h3 class="news_title">@article.Title</h3>
        <div class="bloginfo">
            <ul>
                <li class="author">作者：<a href="/">@article.Author</a></li>
                <li class="lmname"><a href="/c/@article.ChannelId[article.ChannelId.Length - 1]">@article.ChannelName</a></li>
                <li class="timer">时间：@($"{article.Updated:yyyy年M月d日 HH:mm}")</li>
                <li class="view">@article.Viewed 人已阅读</li>
            </ul>
        </div>
        <div class="news_about"><strong>简介</strong>@article.Summary</div>
        <div class="@(article.Editor == 1 ? "markdown-body" : "" )">
            @((MarkupString)article.Content)
        </div>
    </div>

    <div class="nextinfo">
        <p>上一篇：<a href="/Article/@prevArticle?.Id">@(prevArticle?.Title ?? "已经是第一篇") </a></p>
        <p>下一篇：<a href="/Article/@nextArticle?.Id">@(nextArticle?.Title ?? "已经是最后一篇") </a></p>
    </div>

    <div>
        <AntCard Title="@("评论")">
            <AntRow>
                <AntCol Span="2" style="text-align: right;">
                    <Avatar size="large" Icon="user" />
                </AntCol>
                <AntCol Span="1">
                </AntCol>
                <AntCol Span="20"> <TextArea Placeholder="一语中的" MinRows="3" MaxRows="5"></TextArea></AntCol>
            </AntRow>
            <br />
            <AntRow>
                <AntCol Span="20" Offset="3">
                    <Form Layout="@(FormLayout.Inline)" Model="@comment">
                        <FormItem Label="昵称">
                            <Input @bind-Value="@context.NickName" />
                        </FormItem>

                        <FormItem Label="邮箱">
                            <Input @bind-Value="@context.Email" />
                        </FormItem>

                    </Form>
                </AntCol>
            </AntRow>
            <br />
            <AntList DataSource="@comments">
                <Header>热门评论</Header>
                <Item Context="item">
                    <AntListItemMeta Description="Ant Design, a design language for background applications, is refined by Ant UED Team">
                        <Title>
                            @item.NickName
                        </Title>
                    </AntListItemMeta>
                </Item>
            </AntList>
        </AntCard>
    </div>
</div>


@code {
    [Parameter]
    public string id { get; set; }
    private ArticleModel article { get; set; }
    private ArticleModel prevArticle { get; set; }
    private ArticleModel nextArticle { get; set; }

    private CommentModel comment = new CommentModel();
    private List<CommentModel> comments = new List<CommentModel>();

    protected override async Task OnParametersSetAsync()
    {
        article = await _blogService.GetArticleAsync(id);
        var channelId = article.ChannelId.Last();
        prevArticle = await _blogService.GetPrevArticleAsync(id, channelId);
        nextArticle = await _blogService.GetNextArticleAsync(id, channelId);

        comments.Add(new CommentModel { NickName="奥萨嘎顶顶顶顶", Email="asdfsaasdfasd", Content="大师法士大夫撒地方撒发师德师风" });
        comments.Add(new CommentModel { NickName = "奥萨嘎顶顶顶顶asdfasd", Email = "asdfsaasdfasdaeee", Content = "大师法士大夫撒地方撒发师德师风asge" });
    }
}
